---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import CustomerCard from "@/components/customers/CustomerCard.astro";
// Content
import { getCollection } from "astro:content";
const { frontmatter } = Astro.props;
const customers = await getCollection("customers");
const relatedCustomers = customers
  .filter((customer) => customer.data.name !== frontmatter.name)
  .slice(0, 1);
const imageUrl = frontmatter.image?.url;
const imageAlt = frontmatter.image?.alt || `Portrait of ${frontmatter.name}`;
const type = frontmatter.type ?? "Customer";
const meta = [
  { label: "Service", value: frontmatter.serviceUsed },
  { label: "Vehicle", value: frontmatter.vehicle },
  { label: "Location", value: frontmatter.location },
].filter((item) => Boolean(item.value));
---

<BaseLayout>
  <section class="relative lg:h-dvh w-full overflow-hidden bg-white lg:p-8">
    <div class="absolute inset-0 lg:m-4 lg:rounded-3xl overflow-hidden">
      <Image
        src={imageUrl}
        alt={imageAlt}
        class="size-full object-cover object-center"
        width={1920}
        height={1080}
      />
      <div
        aria-hidden="true"
        class="absolute inset-0 bg-gradient-to-b from-base-900/70 via-base-900/50 to-base-900/90 pointer-events-none"
      >
      </div>
    </div>
    <Wrapper
      variant="standard"
      class="relative z-10 h-full flex flex-col justify-center pt-32 pb-12"
    >
      <div class="lg:text-center">
        <Text
          tag="span"
          variant="textSM"
          class="font-medium tracking-widest text-white font-display uppercase pl-4 border-l border-accent-500"
        >
          {type}
          {frontmatter.name}
        </Text>
        <Text
          tag="h1"
          variant="displayLG"
          class="font-display text-white uppercase mt-8"
        >
          “{frontmatter.quote.trim()}”
        </Text>
      </div>
    </Wrapper>
  </section>
  <section>
    <Wrapper variant="standard" class="py-12">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
        <Wrapper variant="prose" class="lg:col-span-2">
          <slot />
        </Wrapper>
        <div>
          <aside class="lg:sticky lg:top-32">
            <div
              class="flex flex-col bg-white rounded-3xl shadow-2xl outline-4 outline-base-500/10 divide-y divide-base-500/10"
            >
              <div class="p-6">
                <Text
                  tag="h3"
                  variant="textLG"
                  class="font-medium font-display text-base-900 uppercase"
                >
                  About {frontmatter.name}
                </Text>
                <div class="space-y-4 mt-2">
                  {
                    meta.map((item) => (
                      <div>
                        <Text
                          tag="h3"
                          variant="textSM"
                          class="font-medium font-display text-base-900 uppercase"
                        >
                          {item.label}
                        </Text>
                        <Text
                          tag="p"
                          variant="textSM"
                          class="mt-1 text-base-500"
                        >
                          {item.value}
                        </Text>
                      </div>
                    ))
                  }
                </div>
              </div>
              <div class="p-6">
                <Text
                  tag="h3"
                  variant="textLG"
                  class="font-medium font-display text-base-900 uppercase"
                >
                  Need similar help?
                </Text>
                <Text tag="p" variant="textSM" class="mt-2 text-base-500">
                  Tell us about your vehicle and get tailored recommendations.
                </Text>
                <Button
                  isLink
                  href="/contact"
                  variant="default"
                  size="xs"
                  class="mt-12 w-fit"
                >
                  Contact us
                </Button>
              </div>
              <div class="p-6">
                <Text
                  tag="h3"
                  variant="textLG"
                  class="font-medium font-display text-base-900 uppercase"
                >
                  Book a visit
                </Text>
                <Text tag="p" variant="textSM" class="mt-2 text-base-500">
                  Schedule diagnostics, maintenance, or inspections.
                </Text>
                <Button
                  isLink
                  href="/book-appointment"
                  variant="muted"
                  size="xs"
                  class="mt-12 w-fit"
                >
                  Schedule now
                </Button>
              </div>
            </div>
          </aside>
        </div>
      </div>
    </Wrapper>
  </section>
  {
    relatedCustomers.length > 0 && (
      <section class="bg-gradient-to-b from-base-200 to-white">
        <Wrapper variant="standard" class="py-12 lg:py-24">
          <div class="grid grid-cols-1 lg:grid-cols-3 lg:items-end">
            <div class="lg:col-span-2">
              <Text
                tag="h2"
                variant="displayXL"
                class="font-display text-base-900 uppercase mt-8"
              >
                More customer stories
              </Text>
              <Text tag="p" variant="textBase" class="text-base-500 mt-2">
                See how we support drivers and fleets across California.
              </Text>
            </div>
            <Button
              isLink
              href="/customers"
              variant="muted"
              size="sm"
              class="w-fit lg:mt-auto lg:ml-auto"
            >
              View all
            </Button>
          </div>
          <div class="space-y-8  mt-12">
            {relatedCustomers.map((customer) => (
              <CustomerCard customer={customer} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
