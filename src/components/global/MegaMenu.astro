---
// Fundations
import Text from "@/components/fundations/elements/Text.astro";
import Button from "@/components/fundations/elements/Button.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import siteData from "@/data/site.json";

const megaMenuSections = [
  {
    title: "PÃµhikategooriad",
    description: "Populaarseimad juhiloakategooriad",
    links: [
      {
        href: "/kursused/b-kategooria/",
        label: "ğŸš— B-kategooria",
        description: "SÃµiduauto juhiluba",
      },
      {
        href: "/kursused/a-kategooria/",
        label: "ğŸï¸ A-kategooria",
        description: "Mootorratta juhiload (A1, A2, A)",
      },
      {
        href: "/kursused/am-kategooria/",
        label: "ğŸ›µ AM-kategooria",
        description: "Mopeed, roller",
      },
    ],
  },
  {
    title: "Rasketehnika",
    description: "Veoauto ja bussi kategooriad",
    links: [
      {
        href: "/kursused/c-kategooria/",
        label: "ğŸšš C-kategooria",
        description: "Veoauto juhiluba",
      },
      {
        href: "/kursused/ce-kategooria/",
        label: "ğŸš› CE-kategooria",
        description: "Veoauto haagisega",
      },
      {
        href: "/kursused/d-kategooria/",
        label: "ğŸšŒ D-kategooria",
        description: "Bussi juhiluba",
      },
      {
        href: "/kursused/be-kategooria/",
        label: "ğŸš™ BE-kategooria",
        description: "SÃµiduauto haagisega",
      },
    ],
  },
  {
    title: "Muud teenused",
    description: "TÃ¤iendkoolitused",
    links: [
      {
        href: "/loppastmekoolitus/",
        label: "LÃµppastmekoolitus",
        description: "LibedasÃµit ja pimeda aja koolitus",
      },
      {
        href: "/ametikoolitus/",
        label: "Ametikoolitus",
        description: "Kood 95, ADR, tÃµstukijuht",
      },
      {
        href: "/kursused/",
        label: "KÃµik kursused",
        description: "Vaata kÃµiki saadaolevaid kursuseid",
      },
    ],
  },
];
---

<!-- Mega Menu (Desktop) -->
<div
  id="megamenu"
  class="absolute inset-x-0 z-40 hidden top-full"
>
  <Wrapper variant="standard" class="py-2">
    <div
      class="overflow-hidden bg-white shadow-2xl outline-4 outline-base-500/5 outline-inset rounded-3xl max-h-none"
    >
      <div class="grid grid-cols-3 divide-x divide-base-200">
        {
          megaMenuSections.map((section) => (
            <div>
              <div class="px-6 py-4">
                <Text
                  tag="h3"
                  variant="textLG"
                  class="uppercase  font-display text-base-900"
                >
                  {section.title}
                </Text>
                <Text tag="p" variant="textXS" class="mt-2 text-base-600">
                  {section.description}
                </Text>
              </div>
              <ul class="p-6 border-t space-y-4 border-base-200">
                {section.links.map((link) => (
                  <li>
                    <a href={link.href} class="block group rounded-xl ">
                      <Text
                        tag="h4"
                        variant="textSM"
                        class="block font-medium uppercase text-base-900 group-hover:text-accent-600 font-display"
                      >
                        {link.label}
                      </Text>
                      <Text
                        tag="p"
                        variant="textSM"
                        class="block mt-0.5 text-base-500"
                      >
                        {link.description}
                      </Text>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
      <!-- Featured Section -->
      <div class="px-8 py-4 border-t border-base-200">
        <div
          class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 sm:gap-6"
        >
          <div>
            <Text
              tag="h3"
              variant="textBase"
              class="font-medium uppercase text-base-900 font-display"
              >Ready to get started?</Text
            >
            <Text tag="p" variant="textSM" class="mt-1 text-base-600">
              Book an appointment or contact us today.
            </Text>
          </div>
          <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
            <Button isLink size="xs" variant="accent" href="/book-appointment">
              Book an Appointment</Button
            >
            <Button isLink size="xs" variant="muted" href="/contact">
              Contact us</Button
            >
          </div>
        </div>
      </div>
    </div>
  </Wrapper>
</div>
<script is:inline>
  const initMegaMenu = () => {
    const megamenuTrigger = document.getElementById("megamenu-trigger");
    const megamenu = document.getElementById("megamenu");
    if (!megamenuTrigger || !megamenu) return;
    let isMegaOpen = false;
    megamenuTrigger.addEventListener("click", () => {
      isMegaOpen = !isMegaOpen;
      if (isMegaOpen) {
        megamenu.classList.remove("hidden");
      } else {
        megamenu.classList.add("hidden");
      }
      megamenuTrigger.setAttribute("aria-expanded", String(isMegaOpen));
    });
    document.addEventListener("click", (e) => {
      const target = e.target;
      if (
        isMegaOpen &&
        target instanceof HTMLElement &&
        !megamenu.contains(target) &&
        !megamenuTrigger.contains(target)
      ) {
        megamenu.classList.add("hidden");
        megamenuTrigger.setAttribute("aria-expanded", "false");
        isMegaOpen = false;
      }
    });
    megamenu.querySelectorAll("a").forEach((link) => {
      link.addEventListener("click", () => {
        megamenu.classList.add("hidden");
        megamenuTrigger.setAttribute("aria-expanded", "false");
        isMegaOpen = false;
      });
    });
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && isMegaOpen) {
        megamenu.classList.add("hidden");
        megamenuTrigger.setAttribute("aria-expanded", "false");
        isMegaOpen = false;
      }
    });
  };
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initMegaMenu, { once: true });
  } else {
    initMegaMenu();
  }
</script>
